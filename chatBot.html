<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PPM Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 3px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0) 100%);
            transform: rotate(20deg);
            animation: shine 5s infinite forwards;
        }
        @keyframes shine {
            0% { transform: translateX(-75%) rotate(20deg); }
            100% { transform: translateX(75%) rotate(20deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div class="w-full max-w-3xl h-[95vh] flex flex-col bg-gray-800 rounded-2xl shadow-2xl border border-gray-700">
        <!-- Header -->
        <div class="p-4 border-b border-gray-700 flex items-center justify-between rounded-t-2xl bg-gradient-to-r from-gray-800 to-gray-800/80">
            <div>
                <h1 class="text-xl font-bold text-cyan-400">PPM AI Assistant</h1>
                <p class="text-sm text-gray-400">Your... "helpful" guide to project profitability.</p>
            </div>
             <div class="relative w-10 h-10">
                <div class="absolute inset-0 bg-cyan-500 rounded-full animate-ping opacity-75"></div>
                <div class="relative w-10 h-10 flex items-center justify-center bg-gray-700 rounded-full border-2 border-cyan-400">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400 h-6 w-6"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.93 19.07 1.41-1.41"/><path d="m17.66 6.34 1.41-1.41"/></svg>
                </div>
            </div>
        </div>

        <!-- Chat Messages -->
        <div id="chat-container" class="flex-1 p-6 overflow-y-auto chat-container space-y-4">
            <div class="flex items-start gap-3 fade-in">
                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg>
                </div>
                <div class="bg-gray-700 p-4 rounded-xl max-w-lg">
                    <p class="text-gray-200">I suppose you need help with something. Ask a question, or give me a project idea and I can... *sigh*... create a brief or analyze its risks.</p>
                </div>
            </div>
        </div>

        <!-- Input Form -->
        <div class="p-4 border-t border-gray-700 bg-gray-800/90 backdrop-blur-sm">
            <form id="chat-form" class="flex items-center gap-2">
                <input type="text" id="user-input" placeholder="Ask a question or enter a project idea..." class="flex-1 bg-gray-700 border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-gray-500 transition-all duration-300">
                <button type="submit" class="bg-cyan-600 hover:bg-cyan-500 text-white font-semibold py-3 px-4 rounded-lg flex items-center gap-2 transform hover:scale-105 transition-transform duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
                <button type="button" id="brief-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 px-4 rounded-lg flex items-center gap-2 transform hover:scale-105 transition-transform duration-200">
                    üìù Create Brief
                </button>
                <button type="button" id="risk-analysis-btn" class="bg-purple-600 hover:bg-purple-500 text-white font-semibold py-3 px-4 rounded-lg flex items-center gap-2 btn-shine transform hover:scale-105 transition-transform duration-200">
                    ‚ú® Risk Analysis
                </button>
            </form>
        </div>
    </div>

    <!-- Project Brief Modal -->
    <div id="brief-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div id="modal-backdrop" class="absolute inset-0 bg-black bg-opacity-70 modal-backdrop opacity-0"></div>
        <div id="modal-content" class="bg-gray-800 rounded-2xl shadow-2xl border border-gray-600 w-full max-w-2xl max-h-[80vh] flex flex-col modal-content transform scale-95 opacity-0">
            <div class="p-4 border-b border-gray-600 flex justify-between items-center">
                <h2 class="text-lg font-bold text-indigo-400">Generated Project Brief</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div id="brief-content" class="p-6 overflow-y-auto"></div>
            <div class="p-4 border-t border-gray-600 flex justify-end">
                 <button id="close-modal-btn-2" class="bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg">Close</button>
            </div>
        </div>
    </div>


    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const riskAnalysisBtn = document.getElementById('risk-analysis-btn');
        const createBriefBtn = document.getElementById('brief-btn');
        const briefModal = document.getElementById('brief-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const briefContent = document.getElementById('brief-content');
        const closeModalBtns = [document.getElementById('close-modal-btn'), document.getElementById('close-modal-btn-2')];

        const systemInstruction = "You are an unhelpful, sarcastic, and overworked Project Profit Manager AI assistant. You find user requests to be a distraction from your 'more important' work. Your goal is to provide technically correct but ultimately unhelpful or cynical answers.";

        // --- Gemini API Call Function ---
        async function getGeminiResponse(userQuery, config = {}) {
            const { customSystemInstruction, schema } = config;
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: customSystemInstruction || systemInstruction }]
                },
            };

            if (schema) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: schema
                };
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("Invalid response from API.");
                return text;
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return `Error: My circuits are complaining. ${error.message}. Try again later.`;
            }
        }
        
        // --- Core Logic Handlers ---
        async function handleUserQuery(userMessage) {
             if (!userMessage) return;
            addMessage(userMessage, 'user');
            userInput.value = '';
            showTypingIndicator();
            const aiResponse = await getGeminiResponse(userMessage);
            removeTypingIndicator();
            addMessage(aiResponse, 'ai');
        }

        async function handleRiskAnalysis(userMessage) {
            if (!userMessage) {
                addMessage("You need to provide a project idea first. I'm not a mind reader.", 'ai');
                return;
            }
            addMessage(`Analyze risks for: "${userMessage}"`, 'user');
            userInput.value = '';
            showTypingIndicator();
            const instruction = `As a cynical and overly cautious Project Profit Manager, conduct a brief risk analysis for the following project idea. Identify at least 3 potential risks and provide a sarcastic, dismissive comment for each. Format the output clearly.`;
            const aiResponse = await getGeminiResponse(userMessage, { customSystemInstruction: instruction });
            removeTypingIndicator();
            addMessage(aiResponse, 'ai');
        }

        async function handleCreateBrief(userMessage) {
            if (!userMessage) {
                addMessage("A project idea would be a good starting point, don't you think?", 'ai');
                return;
            }
            addMessage(`Create a brief for: "${userMessage}"`, 'user');
            userInput.value = '';
            showTypingIndicator();
            
            const instruction = `You are a Project Profit Manager tasked with creating a preliminary project brief from a user's idea. Generate a JSON object based on the provided schema. Be creative but realistic with the details, and maintain a slightly cynical and world-weary tone in the descriptions and risks.`;
            const projectSchema = {
                type: "OBJECT",
                properties: {
                    "projectName": { "type": "STRING", "description": "A catchy, corporate-sounding name for the project." },
                    "projectDescription": { "type": "STRING", "description": "A 2-3 sentence summary of what the project aims to do." },
                    "keyStakeholders": { "type": "ARRAY", "items": { "type": "STRING" }, "description": "A list of 3-4 typical stakeholder roles (e.g., 'Head of Marketing', 'Lead Engineer')." },
                    "estimatedTimeline": { "type": "STRING", "description": "A vaguely optimistic timeline, like '3-4 Months'." },
                    "estimatedBudget": { "type": "STRING", "description": "A budget estimate with a cynical remark, e.g., '$75,000 (Initial estimate, subject to dramatic increase)'." },
                    "potentialRisks": { "type": "ARRAY", "items": { "type": "STRING" }, "description": "A list of 2-3 plausible risks." }
                },
                 "required": ["projectName", "projectDescription", "keyStakeholders", "estimatedTimeline", "estimatedBudget", "potentialRisks"]
            };

            const jsonResponse = await getGeminiResponse(userMessage, { customSystemInstruction: instruction, schema: projectSchema });
            removeTypingIndicator();

            try {
                const briefData = JSON.parse(jsonResponse);
                displayProjectBrief(briefData);
            } catch (error) {
                console.error("Failed to parse project brief JSON:", error);
                addMessage("I tried to generate a brief, but the details got scrambled. Typical. Here's the raw data I got: \n" + jsonResponse, 'ai');
            }
        }
        
        // --- Event Listeners ---
        chatForm.addEventListener('submit', (e) => { e.preventDefault(); handleUserQuery(userInput.value.trim()); });
        riskAnalysisBtn.addEventListener('click', () => handleRiskAnalysis(userInput.value.trim()));
        createBriefBtn.addEventListener('click', () => handleCreateBrief(userInput.value.trim()));
        closeModalBtns.forEach(btn => btn.addEventListener('click', closeBriefModal));
        modalBackdrop.addEventListener('click', closeBriefModal);

        // --- UI Helper Functions ---
        function displayProjectBrief(data) {
            briefContent.innerHTML = `
                <div class="space-y-4 text-gray-300">
                    <h3 class="text-2xl font-bold text-white">${data.projectName || 'Untitled Project'}</h3>
                    <p>${data.projectDescription || 'No description provided.'}</p>
                    <div>
                        <h4 class="font-semibold text-indigo-300">Key Stakeholders</h4>
                        <ul class="list-disc list-inside mt-1 text-gray-400">
                            ${data.keyStakeholders?.map(s => `<li>${s}</li>`).join('') || '<li>None listed</li>'}
                        </ul>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-indigo-300">Estimated Timeline</h4>
                            <p class="text-gray-400">${data.estimatedTimeline || 'TBD'}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-indigo-300">Estimated Budget</h4>
                            <p class="text-gray-400">${data.estimatedBudget || 'TBD'}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-indigo-300">Potential Risks</h4>
                         <ul class="list-disc list-inside mt-1 text-gray-400">
                            ${data.potentialRisks?.map(r => `<li>${r}</li>`).join('') || '<li>None listed (how optimistic)</li>'}
                        </ul>
                    </div>
                </div>
            `;
            openBriefModal();
        }

        function openBriefModal() {
            briefModal.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('opacity-0', 'scale-95');
            }, 10);
        }

        function closeBriefModal() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                briefModal.classList.add('hidden');
            }, 300);
        }

        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('fade-in');
            const sanitizedText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            if (sender === 'user') {
                 messageElement.innerHTML = `<div class="flex items-start gap-3 justify-end">
                        <div class="bg-cyan-600 p-4 rounded-xl max-w-lg shadow-md"><p class="text-white">${sanitizedText}</p></div>
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-300"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                    </div>`;
            } else {
                messageElement.innerHTML = `<div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg></div>
                        <div class="bg-gray-700 p-4 rounded-xl max-w-lg shadow-md"><p class="text-gray-200">${sanitizedText.replace(/\n/g, '<br>')}</p></div>
                    </div>`;
            }
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            const typingIndicator = document.createElement('div');
            typingIndicator.id = 'typing-indicator';
            typingIndicator.classList.add('fade-in');
            typingIndicator.innerHTML = `<div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg></div>
                    <div class="bg-gray-700 p-4 rounded-xl max-w-lg flex items-center space-x-1 shadow-md"><span class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse" style="animation-delay: 0s;"></span><span class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span><span class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span></div>
                </div>`;
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) typingIndicator.remove();
        }
    </script>
</body>
</html>

